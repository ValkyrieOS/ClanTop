<!DOCTYPE html>
<html lang="es" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Top de Servidores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
                950: "#082f49",
              },
            },
            animation: {
              "fade-in": "fadeIn 0.5s ease-out",
              "slide-up": "slideUp 0.5s ease-out",
            },
            keyframes: {
              fadeIn: {
                "0%": { opacity: "0" },
                "100%": { opacity: "1" },
              },
              slideUp: {
                "0%": { transform: "translateY(20px)", opacity: "0" },
                "100%": { transform: "translateY(0)", opacity: "1" },
              },
            },
          },
          fontFamily: {
            sans: [
              "Inter",
              "ui-sans-serif",
              "system-ui",
              "-apple-system",
              "BlinkMacSystemFont",
              "Segoe UI",
              "Roboto",
              "Helvetica Neue",
              "Arial",
              "Noto Sans",
              "sans-serif",
              "Apple Color Emoji",
              "Segoe UI Emoji",
              "Segoe UI Symbol",
              "Noto Color Emoji",
            ],
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      .progress-bar {
        transition: width 0.5s ease-out;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-100 font-sans min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-4xl font-bold text-center mb-8 text-primary-400">
        Top de Servidores
      </h1>

      <!-- Estadísticas generales -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div class="bg-gray-800 p-4 rounded-lg shadow-lg animate-fade-in">
          <p id="totalServers" class="text-2xl font-semibold text-primary-400">
            0
          </p>
          <p class="text-sm text-gray-400">Servidores Totales</p>
        </div>
        <div
          class="bg-gray-800 p-4 rounded-lg shadow-lg animate-fade-in"
          style="animation-delay: 0.1s"
        >
          <p id="totalMembers" class="text-2xl font-semibold text-primary-400">
            0
          </p>
          <p class="text-sm text-gray-400">Miembros Totales</p>
        </div>
        <div
          class="bg-gray-800 p-4 rounded-lg shadow-lg animate-fade-in"
          style="animation-delay: 0.2s"
        >
          <p id="onacMembers" class="text-2xl font-semibold text-primary-400">
            0
          </p>
          <p class="text-sm text-gray-400">Miembros ONAC</p>
        </div>
      </div>

      <!-- Filtros y búsqueda -->
      <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
        <div class="flex flex-wrap gap-2">
          <button
            id="filterAll"
            class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-colors"
          >
            Todos
          </button>
          <button
            id="filterOnac"
            class="px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-colors"
          >
            ONAC
          </button>
          <button
            id="filterNonOnac"
            class="px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-colors"
          >
            No ONAC
          </button>
        </div>
        <input
          type="text"
          id="searchInput"
          placeholder="Buscar servidor..."
          class="px-4 py-2 bg-gray-800 text-white rounded-md border border-gray-700 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-colors"
        />
      </div>

      <!-- Lista de servidores -->
      <div id="serverList" class="space-y-4"></div>
      <p
        id="noResults"
        class="text-center text-gray-400 mt-8 hidden animate-fade-in"
      >
        No se encontraron servidores que coincidan con tu búsqueda
      </p>

      <!-- Paginación -->
      <div class="flex justify-center items-center mt-8 space-x-2">
        <button
          id="prevPage"
          class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Anterior
        </button>
        <div id="pageNumbers" class="flex items-center space-x-2"></div>
        <button
          id="nextPage"
          class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Siguiente
        </button>
      </div>
    </div>

    <script>
      // Variables globales
      let allServers = [];
      let onacServers = [];
      let filteredServers = [];
      let currentPage = 1;
      const serversPerPage = 10;
      let currentFilter = "all";

      // Elementos del DOM
      const searchInput = document.getElementById("searchInput");
      const serverList = document.getElementById("serverList");
      const noResults = document.getElementById("noResults");
      const totalServersElement = document.getElementById("totalServers");
      const totalMembersElement = document.getElementById("totalMembers");
      const onacMembersElement = document.getElementById("onacMembers");
      const prevPageButton = document.getElementById("prevPage");
      const nextPageButton = document.getElementById("nextPage");
      const pageNumbersContainer = document.getElementById("pageNumbers");
      const filterAllButton = document.getElementById("filterAll");
      const filterOnacButton = document.getElementById("filterOnac");
      const filterNonOnacButton = document.getElementById("filterNonOnac");

      // Función para cargar los datos de los servidores
      async function loadServerData() {
        try {
          const [serversResponse, onacResponse] = await Promise.all([
            fetch("lista_completa_servidores.json"),
            fetch("onac.json"),
          ]);
          const serversData = await serversResponse.json();
          const onacData = await onacResponse.json();

          allServers = serversData.filter(
            (server) => server.name !== "ONAC NauticMC"
          );

          // Procesar los datos de ONAC
          onacServers = onacData
            .map((onacServerName) => {
              const server = allServers.find((s) => s.name === onacServerName);
              if (server) {
                server.isOnacMember = true;
                return server;
              }
              return null;
            })
            .filter((server) => server !== null);

          // Calcular el total de miembros de ONAC
          const onacTotalMembers = onacServers.reduce(
            (sum, server) => sum + server.members,
            0
          );

          // Crear un servidor "virtual" para ONAC
          const onacVirtualServer = {
            name: "ONAC (Total)",
            members: onacTotalMembers,
            isOnac: true,
            rank: 0, // Se asignará después
          };

          // Añadir el servidor virtual de ONAC a la lista de todos los servidores
          allServers.push(onacVirtualServer);

          // Ordenar los servidores por número de miembros
          allServers.sort((a, b) => b.members - a.members);

          // Asignar rangos
          allServers.forEach((server, index) => {
            server.rank = index + 1;
          });

          filteredServers = allServers;
          updateStats();
          renderServers();

          // Event listeners
          searchInput.addEventListener("input", handleSearch);
          prevPageButton.addEventListener("click", () =>
            changePage(currentPage - 1)
          );
          nextPageButton.addEventListener("click", () =>
            changePage(currentPage + 1)
          );
          filterAllButton.addEventListener("click", () => filterServers("all"));
          filterOnacButton.addEventListener("click", () =>
            filterServers("onac")
          );
          filterNonOnacButton.addEventListener("click", () =>
            filterServers("non-onac")
          );
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      function updateStats() {
        const totalServers = allServers.length;
        const totalMembers = allServers.reduce(
          (sum, server) => (server.isOnac ? sum : sum + server.members),
          0
        );
        const onacMembers =
          allServers.find((server) => server.isOnac)?.members || 0;

        animateNumber(totalServersElement, 0, totalServers, 1000);
        animateNumber(totalMembersElement, 0, totalMembers, 1000);
        animateNumber(onacMembersElement, 0, onacMembers, 1000);
      }

      function animateNumber(element, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          element.textContent = Math.floor(
            progress * (end - start) + start
          ).toLocaleString();
          if (progress < 1) {
            window.requestAnimationFrame(step);
          }
        };
        window.requestAnimationFrame(step);
      }

      function renderServers() {
        const startIndex = (currentPage - 1) * serversPerPage;
        const endIndex = startIndex + serversPerPage;
        const serversToShow = filteredServers.slice(startIndex, endIndex);

        serverList.innerHTML = "";
        noResults.classList.toggle("hidden", serversToShow.length > 0);

        const totalMembers = allServers.reduce(
          (sum, server) => (server.isOnac ? sum : sum + server.members),
          0
        );

        serversToShow.forEach((server, index) => {
          const card = document.createElement("div");
          card.className =
            "bg-gray-800 p-4 rounded-lg shadow-lg animate-slide-up";
          card.style.animationDelay = `${index * 0.05}s`;

          const percentageDomination = (
            (server.members / totalMembers) *
            100
          ).toFixed(2);

          card.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h2 class="text-xl font-semibold ${
                          server.isOnac ? "text-yellow-400" : "text-primary-400"
                        }">
                            ${server.name}
                            ${
                              server.isOnac
                                ? '<span class="ml-2 bg-yellow-500 text-yellow-900 px-2 py-1 rounded-full text-xs font-bold">ONAC</span>'
                                : ""
                            }
                            ${
                              server.isOnacMember
                                ? '<span class="ml-2 bg-green-500 text-green-900 px-2 py-1 rounded-full text-xs font-bold">ONAC member</span>'
                                : ""
                            }
                        </h2>
                        <span class="text-sm font-semibold ${
                          server.isOnac ? "text-yellow-400" : "text-primary-400"
                        }">#${server.rank}</span>
                    </div>
                    <p class="text-gray-300 mb-2">Miembros: ${server.members.toLocaleString()}</p>
                    <div class="relative pt-1">
                        <div class="flex mb-2 items-center justify-between">
                            <div>
                                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full ${
                                  server.isOnac
                                    ? "text-yellow-200 bg-yellow-900"
                                    : "text-primary-200 bg-primary-900"
                                }">
                                    Dominio
                                </span>
                            </div>
                            <div class="text-right">
                                <span class="text-xs font-semibold inline-block ${
                                  server.isOnac
                                    ? "text-yellow-400"
                                    : "text-primary-400"
                                }">
                                    ${percentageDomination}%
                                </span>
                            </div>
                        </div>
                        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-700">
                            <div style="width:${percentageDomination}%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center ${
            server.isOnac ? "bg-yellow-500" : "bg-primary-500"
          } "></div>
                        </div>
                    </div>
                `;

          serverList.appendChild(card);
        });

        updatePagination();
      }

      function handleSearch() {
        const searchTerm = searchInput.value.toLowerCase();
        filterAndRenderServers(searchTerm);
      }

      function filterServers(filter) {
        currentFilter = filter;
        const searchTerm = searchInput.value.toLowerCase();
        filterAndRenderServers(searchTerm);

        // Update button styles
        [filterAllButton, filterOnacButton, filterNonOnacButton].forEach(
          (button) => button.classList.remove("bg-primary-600")
        );

        const activeButton =
          filter === "all"
            ? filterAllButton
            : filter === "onac"
            ? filterOnacButton
            : filterNonOnacButton;
        activeButton.classList.add("bg-primary-600");
      }

      function filterAndRenderServers(searchTerm) {
        filteredServers = allServers.filter((server) => {
          const nameMatch = server.name.toLowerCase().includes(searchTerm);
          const filterMatch =
            currentFilter === "all" ||
            (currentFilter === "onac" &&
              (server.isOnac || server.isOnacMember)) ||
            (currentFilter === "non-onac" &&
              !server.isOnac &&
              !server.isOnacMember);
          return nameMatch && filterMatch;
        });
        currentPage = 1;
        renderServers();
      }

      function changePage(newPage) {
        currentPage = newPage;
        renderServers();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function updatePagination() {
        const totalPages = Math.ceil(filteredServers.length / serversPerPage);

        prevPageButton.disabled = currentPage === 1;
        nextPageButton.disabled = currentPage === totalPages;

        pageNumbersContainer.innerHTML = "";

        const maxVisiblePages = 5;
        let startPage = Math.max(
          1,
          currentPage - Math.floor(maxVisiblePages / 2)
        );
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        if (endPage - startPage + 1 < maxVisiblePages) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        if (startPage > 1) {
          addPageButton(1);
          if (startPage > 2) {
            addEllipsis();
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          addPageButton(i);
        }

        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            addEllipsis();
          }
          addPageButton(totalPages);
        }
      }

      function addPageButton(pageNum) {
        const button = document.createElement("button");
        button.textContent = pageNum;
        button.className = `px-3 py-1 rounded-md transition-colors ${
          pageNum === currentPage
            ? "bg-primary-600 text-white"
            : "bg-gray-700 text-gray-300 hover:bg-gray-600"
        }`;
        button.addEventListener("click", () => changePage(pageNum));
        pageNumbersContainer.appendChild(button);
      }

      function addEllipsis() {
        const ellipsis = document.createElement("span");
        ellipsis.textContent = "...";
        ellipsis.className = "px-2 text-gray-400";
        pageNumbersContainer.appendChild(ellipsis);
      }

      // Cargar los datos de los servidores al iniciar la página
      loadServerData();
    </script>
  </body>
</html>
